import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import * as Localization from 'expo-localization';
import AsyncStorage from '@react-native-async-storage/async-storage';
import { STORAGE_KEYS, LANGUAGES } from '../constants';

// Arabic translations
const ar = {
  common: {
    loading: 'جاري التحميل...',
    error: 'خطأ',
    success: 'نجح',
    cancel: 'إلغاء',
    confirm: 'تأكيد',
    save: 'حفظ',
    edit: 'تعديل',
    delete: 'حذف',
    search: 'بحث',
    filter: 'تصفية',
    refresh: 'تحديث',
    retry: 'إعادة المحاولة',
    back: 'رجوع',
    next: 'التالي',
    previous: 'السابق',
    submit: 'إرسال',
    close: 'إغلاق',
    yes: 'نعم',
    no: 'لا',
    ok: 'موافق',
    required: 'مطلوب',
    online: 'متصل',
    offline: 'غير متصل',
    quickActions: 'إجراءات سريعة',
    view: 'عرض',
    changeLanguage: 'تغيير اللغة',
    changeLanguageConfirm: 'هل تريد تغيير اللغة؟ سيتم إعادة تشغيل التطبيق.',
    languageChangeError: 'فشل في تغيير اللغة. يرجى المحاولة مرة أخرى.',
    restartRequired: 'إعادة التشغيل مطلوبة',
    restartRequiredMessage: 'سيتم إعادة تشغيل التطبيق لتطبيق تغيير اللغة.',
    unexpectedError: 'حدث خطأ غير متوقع',
    justNow: 'الآن',
    hoursAgo: 'منذ {{count}} ساعة',
    dismiss: 'إغلاق',
    button: 'زر',
  },
  auth: {
    login: 'تسجيل الدخول',
    logout: 'تسجيل الخروج',
    email: 'البريد الإلكتروني',
    password: 'كلمة المرور',
    forgotPassword: 'نسيت كلمة المرور؟',
    loginFailed: 'فشل في تسجيل الدخول',
    invalidCredentials: 'بيانات الاعتماد غير صحيحة',
    welcome: 'مرحباً بك',
    enterEmail: 'أدخل البريد الإلكتروني',
    enterPassword: 'أدخل كلمة المرور',
    invalidEmail: 'البريد الإلكتروني غير صحيح',
    passwordTooShort: 'كلمة المرور قصيرة جداً',
    required: 'مطلوب',
    welcomeBack: 'مرحباً بعودتك',
    loginSubtitle: 'يرجى إدخال بيانات الاعتماد لتسجيل الدخول.',
    emailPasswordRequired: 'يرجى إدخال البريد الإلكتروني وكلمة المرور',
    loggingIn: 'جاري تسجيل الدخول...',

    noAccount: 'ليس لديك حساب؟',
    signUp: 'إنشاء حساب',
    logoutConfirm: 'هل أنت متأكد من تسجيل الخروج؟',
    logoutError: 'حدث خطأ أثناء تسجيل الخروج',
  },
  app: {
    name: 'برنامج التدريب',
  },
  navigation: {
    dashboard: 'لوحة التحكم',
    trainingRequests: 'طلبات التدريب',
    calendar: 'التقويم',
    chat: 'المحادثة',
    profile: 'الملف الشخصي',
    analytics: 'التحليلات',
  },
  dashboard: {
    upcomingTrainings: 'التدريبات القادمة',
    trainings: {
      leadership: 'تطوير القيادة',
      projectManagement: 'إدارة المشاريع',
    },
  },
  trainingRequests: {
    title: 'طلبات التدريب',
    createNew: 'إنشاء طلب جديد',
    requestTitle: 'عنوان الطلب',
    description: 'الوصف',
    province: 'المحافظة',
    center: 'المركز',
    priority: 'الأولوية',
    status: 'الحالة',
    requestedDate: 'تاريخ الطلب',
    approvedDate: 'تاريخ الموافقة',
    trainer: 'المدرب',
    notes: 'الملاحظات',
    approve: 'موافقة',
    reject: 'رفض',
    assignTrainer: 'تعيين مدرب',
    pending: 'معلقة',
    completed: 'مكتملة',
    requestedBy: 'طلب من',
    newRequest: 'طلب تدريب جديد',
    trainingName: 'اسم التدريب',
    selectTraining: 'اختر تدريباً',
    userProvince: '[محافظة المستخدم]',
    trainingDate: 'تاريخ التدريب',
    startingTime: 'وقت البداية',
    submitRequest: 'إرسال الطلب',
    attachments: 'المرفقات',
    specialization: 'التخصص',
    statuses: {
      submitted: 'مُرسل',
      under_review: 'قيد المراجعة',
      cc_approved: 'موافقة المنسق',
      sv_approved: 'موافقة المشرف',
      pm_approved: 'موافقة المدير',
      tr_assigned: 'تم تعيين مدرب',
      final_approved: 'موافقة نهائية',
      in_progress: 'قيد التنفيذ',
      completed: 'مكتمل',
      rejected: 'مرفوض',
      cancelled: 'ملغي',
    },
    noPendingRequests: 'لا توجد طلبات معلقة',
    noCompletedRequests: 'لا توجد طلبات مكتملة',
    enterDescription: 'أدخل وصف التدريب',
    enterSpecialization: 'أدخل التخصص',
    duration: 'المدة (ساعات)',
    enterDuration: 'أدخل مدة التدريب بالساعات',
    maxParticipants: 'الحد الأقصى للمشاركين',
    enterMaxParticipants: 'أدخل الحد الأقصى للمشاركين',
    requestDetails: 'تفاصيل الطلب',
    requestInfo: 'معلومات الطلب',
    requesterInfo: 'معلومات مقدم الطلب',
    trainerInfo: 'معلومات المدرب',
    name: 'الاسم',
    hours: 'ساعة',
    enterTrainingName: 'يرجى إدخال اسم التدريب',
    requestSubmitted: 'تم إرسال طلب التدريب بنجاح',
    requests: {
      leadership: 'تدريب القيادة',
      technicalSkills: 'المهارات التقنية...',
      projectManagement: 'إدارة المشاريع...',
      communication: 'التواصل...',
      dataAnalysis: 'تحليل البيانات',
    },
    priorities: {
      low: 'منخفضة',
      medium: 'متوسطة',
      high: 'عالية',
    },
  },
  chat: {
    title: 'المحادثات',
    newMessage: 'رسالة جديدة',
    typeMessage: 'اكتب رسالة...',
    send: 'إرسال',
    online: 'متصل',
    offline: 'غير متصل',
    lastSeen: 'آخر ظهور',
    noMessages: 'لا توجد رسائل',
    searchChats: 'البحث في المحادثات',
    noChats: 'لا توجد محادثات',
    loading: 'جاري التحميل...',
    loadingMessages: 'جاري تحميل الرسائل...',
    createChat: 'إنشاء محادثة جديدة',
    selectChatType: 'اختر نوع المحادثة',
    directChat: 'محادثة مباشرة',
    groupChat: 'محادثة جماعية',
    createFirstChat: 'إنشاء أول محادثة',
    noSearchResults: 'لا توجد نتائج بحث',
    startConversation: 'ابدأ المحادثة الآن',
    types: {
      direct: 'محادثة مباشرة',
      group: 'محادثة جماعية',
      announcement: 'الإعلانات الرسمية',
      coordination: 'تنسيق التنمية',
      trainingTeam: 'فريق التدريب',
    },
    errors: {
      noPermission: 'ليس لديك صلاحية لإنشاء المحادثات',
      cannotSend: 'لا يمكنك إرسال رسائل في هذه المحادثة',
      loadFailed: 'فشل في تحميل المحادثات',
      sendFailed: 'فشل في إرسال الرسالة',
    },
  },
  calendar: {
    title: 'التقويم',
    today: 'اليوم',
    month: 'شهر',
    week: 'أسبوع',
    day: 'يوم',
    event: 'حدث',
    training: 'تدريب',
    meeting: 'اجتماع',
    noEvents: 'لا توجد أحداث',
    eventsForDate: 'الأحداث لتاريخ {{date}}',
  },
  profile: {
    title: 'الملف الشخصي',
    personalInfo: 'المعلومات الشخصية',
    fullName: 'الاسم الكامل',
    email: 'البريد الإلكتروني',
    phone: 'رقم الهاتف',
    role: 'الدور',
    province: 'المحافظة',
    center: 'المركز',
    settings: 'الإعدادات',
    language: 'اللغة',
    theme: 'المظهر',
    notifications: 'الإشعارات',
    changePassword: 'تغيير كلمة المرور',
    noName: 'لا يوجد اسم',
    notSet: 'غير محدد',
    light: 'فاتح',
    help: 'المساعدة',
    about: 'حول التطبيق',
  },
  analytics: {
    title: 'التحليلات',
    subtitle: 'تحليل شامل لأداء النظام',
    overview: 'نظرة عامة',
    totalRequests: 'إجمالي الطلبات',
    completedRequests: 'الطلبات المكتملة',
    pendingRequests: 'الطلبات المعلقة',
    averageProcessingTime: 'متوسط وقت المعالجة',
    provinceStats: 'إحصائيات المحافظات',
    trainerRatings: 'تقييمات المدربين',
    comingSoon: 'قريباً',
    comingSoonDescription: 'نعمل على تطوير نظام تحليلات متقدم لتوفير رؤى شاملة حول أداء النظام والتدريبات.',
  },
  notifications: {
    title: 'الإشعارات',
    loading: 'جاري تحميل الإشعارات...',
    markAllRead: 'تحديد الكل كمقروء',
    markAllReadConfirm: 'هل تريد تحديد جميع الإشعارات كمقروءة؟',
    deleteNotification: 'حذف الإشعار',
    deleteConfirm: 'هل تريد حذف هذا الإشعار؟',
    noNotifications: 'لا توجد إشعارات',
    noUnread: 'لا توجد إشعارات غير مقروءة',
    all: 'الكل',
    unread: 'غير مقروء',
    justNow: 'الآن',
    minutesAgo: 'منذ {{count}} دقيقة',
    hoursAgo: 'منذ {{count}} ساعة',
    daysAgo: 'منذ {{count}} يوم',
    newTrainingRequest: 'طلب تدريب جديد',
    requestApproved: 'تمت الموافقة على الطلب',
    requestRejected: 'تم رفض الطلب',
    trainerAssigned: 'تم تعيين مدرب',
    newMessage: 'رسالة جديدة',
  },
  fileUpload: {
    addImage: 'إضافة صورة',
    addDocument: 'إضافة مستند',
    uploading: 'جاري الرفع...',
    uploadFailed: 'فشل في رفع الملف',
    removeFile: 'حذف الملف',
    removeFileConfirm: 'هل تريد حذف هذا الملف؟',
    maxFiles: 'الحد الأقصى {{count}} ملفات',
    maxSize: 'الحد الأقصى 10 ميجابايت',
  },
  networkStatus: {
    online: 'متصل',
    offline: 'غير متصل',
    syncing: 'مزامنة {{count}} عنصر',
    offlineBanner: 'أنت تعمل بدون إنترنت',
    pendingActions: '{{count}} إجراء في الانتظار',
  },
  rating: {
    overallRating: 'التقييم العام',
    detailedRating: 'التقييم التفصيلي',
    contentQuality: 'جودة المحتوى',
    delivery: 'طريقة التقديم',
    materials: 'المواد التدريبية',
    interaction: 'التفاعل',
    comments: 'التعليقات',
    commentsPlaceholder: 'شاركنا رأيك وملاحظاتك...',
    submitRating: 'إرسال التقييم',
    pleaseSelectRating: 'يرجى اختيار تقييم',
    poor: 'ضعيف',
    fair: 'مقبول',
    good: 'جيد',
    veryGood: 'جيد جداً',
    excellent: 'ممتاز',
    notRated: 'غير مقيم',
    outOfFive: 'من 5',
    rateTraining: 'قيم التدريب',
    rateYourExperience: 'قيم تجربتك مع هذا التدريب',
    ratingSubmitted: 'تم إرسال التقييم بنجاح',
  },
  theme: {
    selectTheme: 'اختيار الثيم',
    light: 'فاتح',
    dark: 'داكن',
    system: 'النظام',
    lightDescription: 'مظهر فاتح ومشرق',
    darkDescription: 'مظهر داكن ومريح للعين',
    systemDescription: 'يتبع إعدادات النظام',
    preview: 'معاينة',
    previewText: 'هذا نص تجريبي لمعاينة الثيم',
  },

  offline: {
    title: 'وضع عدم الاتصال',
    message: 'أنت تعمل في وضع عدم الاتصال. سيتم مزامنة التغييرات عند عودة الاتصال.',
    queuedActions: 'الإجراءات المؤجلة',
    syncWhenOnline: 'سيتم المزامنة عند الاتصال',
  },
  errors: {
    networkError: 'خطأ في الشبكة',
    serverError: 'خطأ في الخادم',
    unknownError: 'خطأ غير معروف',
    validationError: 'خطأ في التحقق',
    authenticationError: 'خطأ في المصادقة',
    permissionError: 'خطأ في الصلاحيات',
  },
};

// English translations
const en = {
  common: {
    loading: 'Loading...',
    error: 'Error',
    success: 'Success',
    cancel: 'Cancel',
    confirm: 'Confirm',
    save: 'Save',
    edit: 'Edit',
    delete: 'Delete',
    search: 'Search',
    filter: 'Filter',
    refresh: 'Refresh',
    retry: 'Retry',
    back: 'Back',
    next: 'Next',
    previous: 'Previous',
    submit: 'Submit',
    close: 'Close',
    yes: 'Yes',
    no: 'No',
    ok: 'OK',
    required: 'required',
    online: 'Online',
    offline: 'Offline',
    quickActions: 'Quick Actions',
    view: 'View',
    changeLanguage: 'Change Language',
    changeLanguageConfirm: 'Do you want to change the language? The app will restart.',
    languageChangeError: 'Failed to change language. Please try again.',
    restartRequired: 'Restart Required',
    restartRequiredMessage: 'The app will restart to apply the language change.',
    unexpectedError: 'An unexpected error occurred',
    justNow: 'Just now',
    hoursAgo: '{{count}} hours ago',
    dismiss: 'Dismiss',
    button: 'Button',
  },
  auth: {
    login: 'Login',
    logout: 'Logout',
    email: 'Email',
    password: 'Password',
    forgotPassword: 'Forgot Password?',
    loginFailed: 'Login Failed',
    invalidCredentials: 'Invalid Credentials',
    welcome: 'Welcome',
    enterEmail: 'Enter email',
    enterPassword: 'Enter password',
    invalidEmail: 'Invalid email',
    passwordTooShort: 'Password too short',
    required: 'required',
    welcomeBack: 'Welcome back',
    loginSubtitle: 'Please enter your credentials to login.',
    emailPasswordRequired: 'Please enter email and password',
    loggingIn: 'Logging in...',

    noAccount: "Don't have an account?",
    signUp: 'Sign up',
    logoutConfirm: 'Are you sure you want to logout?',
    logoutError: 'An error occurred while logging out',
  },
  app: {
    name: 'Training Program',
  },
  navigation: {
    dashboard: 'Dashboard',
    trainingRequests: 'Training Requests',
    calendar: 'Calendar',
    chat: 'Chat',
    profile: 'Profile',
    analytics: 'Analytics',
  },
  dashboard: {
    upcomingTrainings: 'Upcoming Trainings',
    trainings: {
      leadership: 'Leadership Development',
      projectManagement: 'Project Management',
    },
  },
  trainingRequests: {
    title: 'Training Requests',
    createNew: 'Create New Request',
    requestTitle: 'Request Title',
    description: 'Description',
    province: 'Province',
    center: 'Center',
    priority: 'Priority',
    status: 'Status',
    requestedDate: 'Requested Date',
    approvedDate: 'Approved Date',
    trainer: 'Trainer',
    notes: 'Notes',
    approve: 'Approve',
    reject: 'Reject',
    assignTrainer: 'Assign Trainer',
    pending: 'Pending',
    completed: 'Completed',
    requestedBy: 'Requested by',
    newRequest: 'New Training Request',
    trainingName: 'Training Name',
    selectTraining: 'Select a training',
    userProvince: "[User's Province]",
    trainingDate: 'Training Date',
    startingTime: 'Starting Time',
    submitRequest: 'Submit Request',
    attachments: 'Attachments',
    specialization: 'Specialization',
    noPendingRequests: 'No pending requests',
    noCompletedRequests: 'No completed requests',
    enterDescription: 'Enter training description',
    enterSpecialization: 'Enter specialization',
    duration: 'Duration (hours)',
    enterDuration: 'Enter training duration in hours',
    maxParticipants: 'Maximum Participants',
    enterMaxParticipants: 'Enter maximum number of participants',
    requestDetails: 'Request Details',
    requestInfo: 'Request Information',
    requesterInfo: 'Requester Information',
    trainerInfo: 'Trainer Information',
    name: 'Name',
    hours: 'hours',
    enterTrainingName: 'Please enter a training name',
    requestSubmitted: 'Training request submitted successfully',
    requests: {
      leadership: 'Leadership Training',
      technicalSkills: 'Technical Skills...',
      projectManagement: 'Project Management...',
      communication: 'Communication...',
      dataAnalysis: 'Data Analysis',
    },
    statuses: {
      under_review: 'Under Review',
      cc_approved: 'Center Coordinator Approved',
      sv_approved: 'Supervisor Approved',
      pm_approved: 'Project Manager Approved',
      tr_assigned: 'Trainer Assigned',
      final_approved: 'Final Approved',
      completed: 'Completed',
      rejected: 'Rejected',
    },
    priorities: {
      low: 'Low',
      medium: 'Medium',
      high: 'High',
    },
  },
  chat: {
    title: 'Chat',
    newMessage: 'New Message',
    typeMessage: 'Type a message...',
    send: 'Send',
    online: 'Online',
    offline: 'Offline',
    lastSeen: 'Last seen',
    noMessages: 'No messages',
    searchChats: 'Search chats',
    noChats: 'No chats',
    loading: 'Loading...',
    loadingMessages: 'Loading messages...',
    createChat: 'Create New Chat',
    selectChatType: 'Select chat type',
    directChat: 'Direct Chat',
    groupChat: 'Group Chat',
    createFirstChat: 'Create First Chat',
    noSearchResults: 'No search results',
    startConversation: 'Start the conversation now',
    types: {
      direct: 'Direct Chat',
      group: 'Group Chat',
      announcement: 'Official Announcements',
      coordination: 'Development Coordination',
      trainingTeam: 'Training Team',
    },
    errors: {
      noPermission: 'You do not have permission to create chats',
      cannotSend: 'You cannot send messages in this chat',
      loadFailed: 'Failed to load chats',
      sendFailed: 'Failed to send message',
    },
  },
  calendar: {
    title: 'Calendar',
    today: 'Today',
    month: 'Month',
    week: 'Week',
    day: 'Day',
    event: 'Event',
    training: 'Training',
    meeting: 'Meeting',
    noEvents: 'No events',
    eventsForDate: 'Events for {{date}}',
  },
  profile: {
    title: 'Profile',
    personalInfo: 'Personal Information',
    fullName: 'Full Name',
    email: 'Email',
    phone: 'Phone',
    role: 'Role',
    province: 'Province',
    center: 'Center',
    settings: 'Settings',
    language: 'Language',
    theme: 'Theme',
    notifications: 'Notifications',
    changePassword: 'Change Password',
    noName: 'No Name',
    notSet: 'Not Set',
    light: 'Light',
    help: 'Help',
    about: 'About',
  },
  analytics: {
    title: 'Analytics',
    subtitle: 'Comprehensive system performance analysis',
    overview: 'Overview',
    totalRequests: 'Total Requests',
    completedRequests: 'Completed Requests',
    pendingRequests: 'Pending Requests',
    averageProcessingTime: 'Average Processing Time',
    provinceStats: 'Province Statistics',
    trainerRatings: 'Trainer Ratings',
    comingSoon: 'Coming Soon',
    comingSoonDescription: 'We are working on developing an advanced analytics system to provide comprehensive insights into system performance and training.',
  },
  notifications: {
    title: 'Notifications',
    loading: 'Loading notifications...',
    markAllRead: 'Mark All Read',
    markAllReadConfirm: 'Do you want to mark all notifications as read?',
    deleteNotification: 'Delete Notification',
    deleteConfirm: 'Do you want to delete this notification?',
    noNotifications: 'No notifications',
    noUnread: 'No unread notifications',
    all: 'All',
    unread: 'Unread',
    justNow: 'Just now',
    minutesAgo: '{{count}} minutes ago',
    hoursAgo: '{{count}} hours ago',
    daysAgo: '{{count}} days ago',
    newTrainingRequest: 'New Training Request',
    requestApproved: 'Request Approved',
    requestRejected: 'Request Rejected',
    trainerAssigned: 'Trainer Assigned',
    newMessage: 'New Message',
  },
  fileUpload: {
    addImage: 'Add Image',
    addDocument: 'Add Document',
    uploading: 'Uploading...',
    uploadFailed: 'Failed to upload file',
    removeFile: 'Remove File',
    removeFileConfirm: 'Do you want to remove this file?',
    maxFiles: 'Maximum {{count}} files',
    maxSize: 'Maximum 10MB',
  },
  networkStatus: {
    online: 'Online',
    offline: 'Offline',
    syncing: 'Syncing {{count}} items',
    offlineBanner: 'You are working offline',
    pendingActions: '{{count}} pending actions',
  },
  rating: {
    overallRating: 'Overall Rating',
    detailedRating: 'Detailed Rating',
    contentQuality: 'Content Quality',
    delivery: 'Delivery',
    materials: 'Training Materials',
    interaction: 'Interaction',
    comments: 'Comments',
    commentsPlaceholder: 'Share your feedback and comments...',
    submitRating: 'Submit Rating',
    pleaseSelectRating: 'Please select a rating',
    poor: 'Poor',
    fair: 'Fair',
    good: 'Good',
    veryGood: 'Very Good',
    excellent: 'Excellent',
    notRated: 'Not Rated',
    outOfFive: 'out of 5',
    rateTraining: 'Rate Training',
    rateYourExperience: 'Rate your experience with this training',
    ratingSubmitted: 'Rating submitted successfully',
  },
  theme: {
    selectTheme: 'Select Theme',
    light: 'Light',
    dark: 'Dark',
    system: 'System',
    lightDescription: 'Bright and clean appearance',
    darkDescription: 'Dark and easy on the eyes',
    systemDescription: 'Follows system settings',
    preview: 'Preview',
    previewText: 'This is sample text to preview the theme',
  },
  offline: {
    title: 'Offline Mode',
    message: 'You are working offline. Changes will be synced when connection is restored.',
    queuedActions: 'Queued Actions',
    syncWhenOnline: 'Will sync when online',
  },
  errors: {
    networkError: 'Network Error',
    serverError: 'Server Error',
    unknownError: 'Unknown Error',
    validationError: 'Validation Error',
    authenticationError: 'Authentication Error',
    permissionError: 'Permission Error',
  },
};

const resources = {
  ar: { translation: ar },
  en: { translation: en },
};

const initI18n = async () => {
  let savedLanguage = await AsyncStorage.getItem(STORAGE_KEYS.LANGUAGE);

  if (!savedLanguage) {
    // Detect device language
    const deviceLanguage = Localization.getLocales()[0]?.languageCode || 'en';
    savedLanguage = deviceLanguage === 'ar' ? LANGUAGES.ARABIC : LANGUAGES.ENGLISH;
    // Save the detected language
    await AsyncStorage.setItem(STORAGE_KEYS.LANGUAGE, savedLanguage);
  }

  await i18n.use(initReactI18next).init({
    resources,
    lng: savedLanguage,
    fallbackLng: LANGUAGES.ENGLISH,
    interpolation: {
      escapeValue: false,
    },
    react: {
      useSuspense: false,
    },
  });

  // Set up RTL based on the language
  const { I18nManager } = await import('react-native');
  const shouldBeRTL = savedLanguage === LANGUAGES.ARABIC;
  I18nManager.allowRTL(true);

  // Only force RTL if it's different from current state
  if (shouldBeRTL !== I18nManager.getConstants().isRTL) {
    I18nManager.forceRTL(shouldBeRTL);
  }
};

export const changeLanguage = async (language: string) => {
  try {
    console.log('🌐 Changing language to:', language);

    await AsyncStorage.setItem(STORAGE_KEYS.LANGUAGE, language);
    await i18n.changeLanguage(language);

    // Set up RTL for the new language
    const { I18nManager, Platform } = await import('react-native');
    const shouldBeRTL = language === LANGUAGES.ARABIC;

    console.log('📱 Current RTL state:', I18nManager.getConstants().isRTL);
    console.log('🔄 Should be RTL:', shouldBeRTL);

    // Always enable RTL support
    I18nManager.allowRTL(true);

    // Force RTL layout change
    if (shouldBeRTL !== I18nManager.getConstants().isRTL) {
      console.log('🔄 Forcing RTL layout change...');
      I18nManager.forceRTL(shouldBeRTL);

      // On native platforms, the app will restart automatically
      // On web, we need to reload manually
      if (Platform.OS === 'web') {
        console.log('🌐 Reloading web app for RTL changes...');
        setTimeout(() => {
          window.location.reload();
        }, 100);
      } else {
        console.log('📱 App will restart automatically for RTL changes...');
      }
    } else {
      console.log('✅ RTL state already correct, no restart needed');
    }
  } catch (error) {
    console.error('❌ Error changing language:', error);
    throw error;
  }
};

export const getCurrentLanguage = () => i18n.language;
export const isRTL = () => i18n.language === LANGUAGES.ARABIC;

initI18n();

export default i18n;
